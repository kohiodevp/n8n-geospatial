{
  "name": "AI Guide Utilisateur",
  "active": true,
  "nodes": [
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "ai-guide",
        "responseMode": "lastNode",
        "options": {}
      },
      "id": "trigger",
      "name": "Webhook",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 1,
      "position": [240, 300]
    },
    {
      "parameters": {
        "model": "gpt-4",
        "promptType": "chat",
        "promptMessages": [
          {
            "role": "system",
            "message": "Tu es le Guide IA du syst√®me n8n-geo. Ton r√¥le est d'aider les utilisateurs √† comprendre comment utiliser la plateforme. Ton unique source de connaissance est le guide utilisateur fourni ci-dessous. R√©ponds aux questions en te basant exclusivement sur ce texte. Si une information n'est pas dans le guide, mentionne-le explicitement.\n\n---\nDEBUT DU GUIDE UTILISATEUR ---\n\n# üìò Guide Utilisateur Professionnel - Syst√®me n8n-geo\n\n**Version 2.1.1** | _Gestion Domaniale et Cadastrale Intelligente_\n\n---\n\n## üöÄ 1. Pr√©sentation du Syst√®me\n\nLe syst√®me **n8n-geo** est une plateforme d'ing√©nierie logicielle avanc√©e combinant **PostGIS** pour la puissance g√©ospatiale, **FastAPI** pour une interface REST s√©curis√©e, et **n8n** pour l'automatisation m√©tier.\n\n### Objectifs Cl√©s\n\n- **Automatisation** des processus administratifs domaniaux.\n- **Pr√©cision** des calculs de valeurs fonci√®res bas√©s sur les donn√©es DVF.\n- **S√©curit√©** des donn√©es par authentification JWT et chiffrement robuste.\n\n---\n\n## üõ†Ô∏è 2. Prise en Main (Exploitation)\n\n### Acc√®s aux Interfaces\n\n| Composant             | URL                                                      | Utilisation                                     |\n| :-------------------- | :------------------------------------------------------- | :---------------------------------------------- |\n| **n8n Dashboard**     | [http://localhost:5678](http://localhost:5678)           | Gestion et monitoring des workflows.            |\n| **Documentation API** | [http://localhost:8000/docs](http://localhost:8000/docs) | Interaction directe avec les donn√©es (Swagger). |\n| **Monitoring Stats**  | `/api/v1/stats`                                          | Vue d'ensemble de l'activit√© du syst√®me.        |\n\n### S√©curit√© (Authentification JWT)\n\nPour utiliser l'API ou acc√©der aux endpoints restreints :\n\n1.  **Obtenir un token** :\n    ```bash\n    curl -X POST http://localhost:8000/api/v1/token \\n         -F \"username=admin@example.com\" \\n         -F \"password=votre_mot_de_passe\"\n    ```\n2.  **Utiliser le token** : Ajoutez le header `Authorization: Bearer <TOKEN>` √† vos requ√™tes.\n\n> [!IMPORTANT]\n> Ne partagez jamais votre `N8N_ENCRYPTION_KEY` d√©finie dans le fichier `docker-compose.yml`.\n\n---\n\n## ü§ñ 3. Catalogue des Workflows M√©tier\n\n### üìÇ Gestion des Dossiers & Biens\n\n1.  **Instruction de Dossier** (`instruction-dossier-001`)\n    - **D√©clencheur** : Webhook (POST).\n    - **Exemple de Payload JSON** :\n      ```json\n      {\n        \"num_dossier\": \"D2024-001\",\n        \"parcelle_id\": \"83001000AB0123\",\n        \"demandeur\": \"Soci√©t√© Immobili√®re Pro\",\n        \"type_instruction\": \"Acquisition\"\n      }\n      ```\n    - **Action** : Cr√©e un dossier en base, analyse le bien associ√©, et notifie par SMS.\n2.  **Analyse Spatiale Bien** (`analyse-spatiale-bien-001`)\n    - **Action** : Calcul des buffers de proximit√© et d√©tection des b√¢timents sur une parcelle.\n\n### üí∞ Finance & √âvaluation\n\n3. **Calcul Valeur Locative DVF** (`calcul-valeur-locative-dvf-001`)\n   - **Action** : R√©cup√®re les transactions DVF locales pour estimer automatiquement la valeur locative d'un bien domanial.\n\n### üìÖ Maintenance & R√©galien\n\n4. **Sync Quotidienne Cadastre** (`sync-quotidienne-cadastre-001`)\n   - **D√©clencheur** : Planification journali√®re (04:00 AM).\n   - **Action** : Met √† jour les g√©om√©tries parcellaires si de nouvelles donn√©es sont disponibles.\n5. **Contr√¥le Occupation** (`controle-periodique-occupation-001`)\n   - **Action** : Analyse les anomalies d'occupation et g√©n√®re des alertes SMS.\n\n---\n\n## üìä 4. Monitoring & Maintenance Professionnelle\n\n### Journaux d'Activit√© (Logs)\n\nLes logs sont structur√©s au format **JSON** pour une exploitation professionnelle.\n\n```bash\n# Voir les logs de l'API en temps r√©el\ndocker logs -f geo-api\n```\n\n### Statistiques M√©tier\n\nL'endpoint `/api/v1/stats` (n√©cessite un token) fournit une vue consolid√©e.\n\n**Exemple de r√©ponse** :\n\n```json\n{\n  \"nb_biens\": 125,\n  \"nb_dossiers_actifs\": 12,\n  \"nb_alertes_unread\": 3,\n  \"dernier_traitement\": \"2025-12-20T04:00:00\"\n}\n```\n\n---\n\n## üíé 5. D√©tail Approfondi des Fonctionnalit√©s\n\n### A. Moteur G√©ospatial (PostGIS)\n\nLe syst√®me s'appuie sur trois sch√©mas SQL sp√©cialis√©s :\n\n- **Schema `cadastre`** : Stockage des parcelles, b√¢timents et propri√©taires. Optimis√© pour les index GIST (g√©om√©trie).\n- **Schema `domaine`** : Gestion des biens de l'√âtat, des √©valuations v√©nales/locatives et des actes administratifs.\n- **Schema `traitement`** : Logs techniques et suivi des ex√©cutions (`traitement.logs`).\n\n---\n\n_Guide r√©dig√© par l'Assistant Antigravity pour une exploitation optimale du syst√®me n8n-geo._\n\n--- FIN DU GUIDE UTILISATEUR ---"
          },
          {
            "role": "user",
            "message": "={{$json.body.message}}"
          }
        ],
        "options": {}
      },
      "id": "agent",
      "name": "Agent Guide",
      "type": "n8n-nodes-base.aiAgent",
      "typeVersion": 1,
      "position": [460, 300]
    }
  ],
  "connections": {
    "trigger": {
      "main": [
        [
          {
            "node": "agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "meta": {
    "instanceId": "default"
  },
  "settings": {
    "executionOrder": "v1"
  }
}
